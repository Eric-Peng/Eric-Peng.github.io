<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>javascript理解之Ajax和Http状态字 | eric-peng的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Ajax及其工作原理AJAX 是一种与服务器交换数据无需刷新网页的技术。">
<meta property="og:type" content="article">
<meta property="og:title" content="javascript理解之Ajax和Http状态字">
<meta property="og:url" content="http:eric-peng.github.io/2016/01/07/javascript理解之Ajax和Http状态字/index.html">
<meta property="og:site_name" content="eric-peng的博客">
<meta property="og:description" content="Ajax及其工作原理AJAX 是一种与服务器交换数据无需刷新网页的技术。">
<meta property="og:image" content="http:eric-peng.github.io/img/blog/20160107_1.jpg">
<meta property="og:image" content="http:eric-peng.github.io/img/blog/20160107_2.png">
<meta property="og:updated_time" content="2016-01-07T11:53:58.064Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="javascript理解之Ajax和Http状态字">
<meta name="twitter:description" content="Ajax及其工作原理AJAX 是一种与服务器交换数据无需刷新网页的技术。">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
   
	<script type="text/javascript"> 
		var _hmt = _hmt || [];
			(function() {
			  var hm = document.createElement("script");
			  hm.src = "//hm.baidu.com/hm.js?5dba26570846fb50c527e5133d251a7a";
			  var s = document.getElementsByTagName("script")[0]; 
			  s.parentNode.insertBefore(hm, s);
			})();
	</script>
 


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://tp4.sinaimg.cn/5626580951/180/5728799106/1" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">eric peng</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">我的首页</a></li>
				        
							<li><a href="/archives">全部博客</a></li>
				        
							<li><a href="http://www.baidu.com">在线简历</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/eric-peng" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/5740859095" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/eric-peng-38" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript基础/" style="font-size: 20px;">javascript基础</a> <a href="/tags/javascript算法/" style="font-size: 15px;">javascript算法</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">eric peng</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://tp4.sinaimg.cn/5626580951/180/5728799106/1" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">eric peng</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">我的首页</a></li>
		        
					<li><a href="/archives">全部博客</a></li>
		        
					<li><a href="http://www.baidu.com">在线简历</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/eric-peng" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/5740859095" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/eric-peng-38" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-javascript理解之Ajax和Http状态字" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/07/javascript理解之Ajax和Http状态字/" class="article-date">
  	<time datetime="2016-01-07T10:19:02.000Z" itemprop="datePublished">2016-01-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      javascript理解之Ajax和Http状态字
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript基础/">javascript基础</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a><a class="article-category-link" href="/categories/javascript/Ajax，Http/">Ajax，Http</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Ajax及其工作原理">Ajax及其工作原理</h3><p>AJAX 是一种与服务器交换数据无需刷新网页的技术。</p>
<p><img src="/img/blog/20160107_1.jpg" alt="AJAX工作原理"><br><a id="more"></a></p>
<h3 id="创建_XMLHttpRequest_对象">创建 XMLHttpRequest 对象</h3><pre><code class="bash">//IE6以上
var oAjax = new XMLHttpRequest();
//IE6
var oAjax =new ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>)
</code></pre>
<h3 id="连接服务器">连接服务器</h3><pre><code class="bash">oAjax.open(方法,url,是否异步)
</code></pre>
<h3 id="发送请求send()">发送请求send()</h3><pre><code class="bash">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;
<span class="keyword">function</span> <span class="function"><span class="title">getDoc</span></span>(){
    var xmlhttp;
    <span class="keyword">if</span>(window.xmlhttpRequest){
        xmlhttp=new XMLHttpRequest();
    }
    <span class="keyword">else</span>{
        xmlhttp = new ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);//<span class="keyword">for</span> IE6
    }
    xmlhttp.onreadystatechange = <span class="function"><span class="title">function</span></span>(){
        <span class="keyword">if</span>(xmlhttp.readyState==<span class="number">4</span>&amp;&amp;xmlhttp.status==<span class="number">200</span>){
            document.getElementById(<span class="string">"￼myId"</span>).innerHTML=xmlhttp.responseText;
        }
    }
    xmlhttp.open(<span class="string">"GET"</span>, index.php,<span class="literal">true</span>);
    xmlhttp.send();
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;button <span class="built_in">type</span>=<span class="string">"button"</span> onclick=<span class="string">"getDoc()"</span>&gt;请求数据&lt;/button&gt;
&lt;/body&gt;
</code></pre>
<h3 id="GET_还是_POST？">GET 还是 POST？</h3><p>与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。然而，在以下情况中，请使用 POST 请求：<br>无法使用缓存文件（更新服务器上的文件或数据库）<br>向服务器发送大量数据（POST 没有数据量限制）<br>发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</p>
<h3 id="接收返回信息">接收返回信息</h3><pre><code class="bash">oAjax.onreadystatechange = <span class="function"><span class="title">function</span></span>(){   //当请求状态改变时要调用的事件处理器

    alert(oAjax.readystate);           

}
</code></pre>
<p>只要readyState属性的值发生变化时，便会触发一次readyStatechange事件。可以利用这个事件来检测每次状态变化后readyState的值。通常，我们只对readyState值为4的阶段感兴趣，因为这时所有数据都已经就绪，不过，必须在调用open()之前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性。下面来看一个例子：</p>
<pre><code class="bash">var xhr = createXHR();
xhr.onreadystatechange = <span class="function"><span class="title">function</span></span> () {
    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) {
        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) {
            alert(xhr.statusText);
        } <span class="keyword">else</span> {
            alert(<span class="string">"Request was unsuccessful: "</span> + xhr.status);
        }
    }
};
xhr.open(<span class="string">"get"</span>, <span class="string">"example.txt"</span>, <span class="literal">true</span>);
xhr.send(null);
</code></pre>
<h3 id="XHR对象">XHR对象</h3><p>XMLHttpRequest这个对象的属性有：</p>
<ol>
<li>onreadystatechange  每次状态改变所触发事件的事件处理程序。</li>
<li>responseText     从服务器进程返回数据的字符串形式。</li>
<li>responseXML    从服务器进程返回的DOM兼容的文档数据对象。</li>
<li>status           从服务器返回的数字代码，比如常见的404（未找到）和200（已就绪）</li>
<li>status Text       伴随状态码的字符串信息</li>
</ol>
<p>当XHR对象把一个HTTP请求发送到服务器的过程中会经历几个状态，直到请求被处理，然后才接收一个回应。readyState就是XHR请求的状态属性，它本身有5个属性值：</p>
<p>a.  0（未初始化）还没有调用open()方法<br>b.  1（载入）已调用send()方法，正在发送请求<br>c.  2(载入完成)send()方法完成，已收到全部响应内容<br>d.  3(解析)正在解析响应内容<br>e.  4（完成）响应内容解析完成，可以再客户端使用了</p>
<h3 id="http状态码">http状态码</h3><p>1字头：消息。这一类型的状态码，代表请求已被接受，需要继续处理。<br>2字头：成功。这一类型的状态码，代表请求已成功被服务器接收、理解、并接受。<br>3字头：重定向。这类状态码代表需要客户端采取进一步的操作才能完成请求。<br>4字头：客户端错误。这类状态码代表了客户端看起来可能发生错误，妨碍了服务器的处理。<br>5字头：服务器错误。这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生</p>
<h3 id="status和statusText">status和statusText</h3><p>statusText是响应返回的文本信息，仅当readyState值为3或4的时候才能使用。当readyState为其它值时视图存取statusText属性将引发异常。</p>
<h3 id="jQuery中的Ajax">jQuery中的Ajax</h3><p>GET和POST传入的data是一个键值对 对象，不同的是GET传入的data是通过地址栏传输的，而POST是通过表单提交的，</p>
<pre><code class="bash">$(<span class="function"><span class="title">function</span></span> () {
    $(<span class="string">"input"</span>).click(<span class="function"><span class="title">function</span></span> () {
        $.get(<span class="string">'test.php?url=baidu.com'</span>, <span class="keyword">function</span> (response,status,xhr) {
            $(<span class="string">'#box'</span>).html(response);
        })
    })
});
</code></pre>
<p>POST提交不能使用url传参。post提交可以使用字符串形式的键值对形式传参，自动转换为http消息实体传参</p>
<pre><code class="bash">//post提交可以使用对象键值对
$(<span class="function"><span class="title">function</span></span> () {
    $(<span class="string">"input"</span>).click(<span class="function"><span class="title">function</span></span> () {
        $.post(<span class="string">'test.php'</span>,{
                url:<span class="string">'baidu.com'</span>//post提交可以使用对象键值对
            }, <span class="keyword">function</span> (response,status,xhr) {
            $(<span class="string">'#box'</span>).html(response);
        })
    })
});
</code></pre>
<p>$.get()方法有四个参数，前面三个参数和.load()一样，多了一个第四参数type，即服务器返回的内容格式，包括xml,json,script,html,text等，第一个参数为必选参数，后面三个为可选参数</p>
<p>$.ajax()是所有Ajax方法中最底层的方法，所有其他方法都是基于$.ajax()方法的封装，这个方法只有一个参数，传递一个<br>各个功能键值对的对象。</p>
<p>$.ajax()方法对象参数列表<br><img src="/img/blog/20160107_2.png" alt="ajax"></p>
<pre><code class="bash">$(<span class="function"><span class="title">function</span></span> () {
    $(<span class="string">"input"</span>).click(<span class="function"><span class="title">function</span></span> () {
        $.ajax({
            <span class="built_in">type</span> : <span class="string">"POST"</span>,
            url: <span class="string">'test.php'</span>,
            data:{
                url: <span class="string">'baidu.com'</span>
            },
            success : <span class="keyword">function</span>(response,status,xhr){
                $(<span class="string">'#box'</span>).html(response);
            }
        })
    })
});
</code></pre>
<h3 id="表单序列化">表单序列化</h3><p>Ajax用的最多的地方莫过于表单操作，而传统的表单操作是通过submit提交将数据传输到服务器，如果使用Ajax异步处理的话，我们需要将每个表单元素获取才能提交，这样工作效率就大大降低</p>
<pre><code class="bash">&lt;body&gt;
&lt;form action=<span class="string">""</span>&gt;
    用户名: &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"user"</span> /&gt;
    邮件: &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"email"</span> /&gt;
    &lt;input <span class="built_in">type</span>=<span class="string">"button"</span> value=<span class="string">"提交"</span>/&gt;
&lt;/form&gt;
&lt;div id=<span class="string">"box"</span>&gt;&lt;/div&gt;
&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;
    $(<span class="function"><span class="title">function</span></span> () {
        $(<span class="string">"form input[type=button]"</span>).click(<span class="function"><span class="title">function</span></span> () {
            $.ajax({
                <span class="built_in">type</span>: <span class="string">'POST'</span>,
                url: <span class="string">'test.php'</span>,
                data: {
                    user: $(<span class="string">'form input[name=user]'</span>).val(),
                    email: $(<span class="string">"form input[name=email]"</span>).val(),
                },
                success: <span class="keyword">function</span>(response){
                    $(<span class="string">"#box"</span>).html(response);
                }
            })
        })
    });
&lt;/script&gt;
&lt;/body&gt;
</code></pre>
<p>表单元素特别多的情况下应采用表单序列化，即data:$(“form”).serialize();//得到的是字符串键值对，并且对url进行编码</p>
<p>serialize()方法不但可以序列化表单内的元素，还可以直接获取单选框，复选框和下拉列表框等内容</p>
<pre><code class="bash">&lt;body&gt;
&lt;form action=<span class="string">""</span>&gt;
    用户名: &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"user"</span> /&gt;
    邮件: &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"email"</span> /&gt;
    &lt;input <span class="built_in">type</span>=<span class="string">"button"</span> value=<span class="string">"提交"</span>/&gt;
    &lt;input <span class="built_in">type</span>=<span class="string">"radio"</span> name=<span class="string">"sex"</span> value=<span class="string">"男"</span>/&gt;男
    &lt;input <span class="built_in">type</span>=<span class="string">"radio"</span> name=<span class="string">"sex"</span> value=<span class="string">"女"</span>/&gt;女
    &lt;input <span class="built_in">type</span>=<span class="string">"button"</span> value=<span class="string">"submit"</span>/&gt;
&lt;/form&gt;
&lt;div id=<span class="string">"box"</span>&gt;&lt;/div&gt;
&lt;script&gt;
    $(<span class="function"><span class="title">function</span></span> () {
        $(<span class="string">"form input[name=sex]"</span>).click(<span class="function"><span class="title">function</span></span> () {
            $(<span class="string">'#box'</span>).html(decodeURIComponent($(this).serialize()));
        })
    })
&lt;/script&gt;
&lt;/body&gt;
</code></pre>
<p>参考文章：<a href="http://segmentfault.com/a/1190000000691919" target="_blank" rel="external">http://segmentfault.com/a/1190000000691919</a></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/07/javascript理解之正则表达式/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          javascript理解之正则表达式
        
      </div>
    </a>
  
  
    <a href="/2016/01/07/javascript理解之json/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">javascript理解之json</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="javascript理解之Ajax和Http状态字" data-title="javascript理解之Ajax和Http状态字" data-url="http:eric-peng.github.io/2016/01/07/javascript理解之Ajax和Http状态字/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"eric-peng"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-right">
    		&copy; 2016 eric peng
    	</div>      	
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: undefined,
		animate: undefined,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






  </div>
</body>
</html>